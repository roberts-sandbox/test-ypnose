<!DOCTYPE html>
<html lang="fr">
<head>
	<!--[if lt IE 9]>
	<script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<meta charset="utf-8" />
	<meta name="author" content="Ypnose" />
	
	<meta name="description" content="Les péripéties d'un libriste convaincu et passionné de 23 ans." />
	
	<meta name="viewport" content="width=device-width" />
	<link rel="stylesheet" type="text/css" href="/assets/css/style.css" />
	<link rel="alternate" type="application/rss+xml" title="Flux RSS" href="/atom.xml" />
	<link rel="icon" type="image/png" href="/assets/images/favicon.png" />
	
	<title>Guide de l'upgrade de filesystem sous Archlinux | Dans la Tête du Linuxien</title>
	
	<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-22314110-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

</head>
<body>
	<div class="container">
	<div id="widthmes">
	Vous utilisez un écran ayant une largeur inférieure à 350px.
	Par conséquent, les images ne seront pas affichées et il est possible que la navigation ne soit pas optimale.
</div>

	<div><a href="https://github.com/Ypnose?tab=repositories" class="githubrib">Fork Me</a></div>
	<header>
		<a href="/" title="Dans la Tête du Linuxien"></a>
	</header>

	<nav>
		<ul>
		<li><a href="/">/root</a> &middot;</li>
		<li><a href="/archives/">Archives</a> &middot;</li>
		<li><a href="/hardware/">Hardware</a> &middot;</li>
		<li><a href="/qui-suis-je/">Qui suis-je?</a> &middot;</li>
		<li><a href="/a-savoir/">À savoir</a> &middot;</li>
		<li><a href="/me-contacter/">Me contacter</a> &middot;</li>
		<li><a href="/atom.xml">RSS</a></li>
		</ul>
	</nav>

	<div class="barnav"></div>

	<article>
	<div class="infobox">

		<h1>Guide de l'upgrade de filesystem sous Archlinux</h1>

		<div>
			Par <a href="/qui-suis-je/">Ypnose</a> - Posté le 05.10.2012
		</div>
		<div>
			<span> &rarr; </span><a href="/categories/Astuce/">Astuce</a>
		</div>

	</div>

	<p>Salut les cocos,</p>

<p>Malgré le fait que je sois plutôt occupé en ce moment, j’arrive à trouver le temps et surtout l’inspiration pour mes articles. Je ne suis pas mécontent de la fréquence actuelle, à savoir un article par mois (à peu de choses près). Vous savez aussi que je ne veux pas me lancer dans une optique, d’un article par semaine. Je préfère vous pondre quelque chose de complet et d’intéressant. C’est un peu la recette de ce site (je n’aime pas le mot blog finalement, cela me fait penser à du Skyblog…).</p>

<!-- more -->

<p>Aujourd’hui, j’ai décidé d’écrire un article fonctionnel. Je sais qu’une bonne partie de mes lecteurs provient du forum <a href="http://forums.archlinux.fr/">Archlinux.fr</a> et aussi de son <a href="http://planet.archlinux.fr/">Planet</a>. Cela implique que pas mal de personnes ici, utilisent Archlinux. D’ailleurs, je dois beaucoup à cette communauté et à cette distrib, je ne l’oublie pas.</p>

<p><img class="imgcenter" alt="arch" src="http://linuxien.legtux.org/uploads/images/2012/10/archlinux.png" /></p>

<p>Lors de la mise-à-jour quasi-journalière, il a été proposé <a href="http://www.archlinux.org/packages/core/any/filesystem/">filesystem</a> en plus de <a href="http://www.archlinux.org/packages/core/x86_64/systemd/">systemd</a> (que je trouve super) et <a href="http://www.archlinux.org/packages/core/x86_64/util-linux/">util-linux</a>. Je me suis renseigné sur le <a href="https://projects.archlinux.org/svntogit/packages.git/log/trunk?h=packages/filesystem">git</a>, comme j’ai l’habitude de faire pour les paquets “essentiels”, afin de voir les changements. À l’issue de cette maintenance, pacman m’installe les fichiers passwd, group et gshadow (contenus dans l’archive), en *.pacnew. L’intervention administrateur impose le merge des nouveautés dans les fichiers existants.</p>

<p>Il est important de prendre connaissance des modifications. Si vous ne le faites pas, vous vous exposez à des éventuels bugs / limitations, qui ne devraient pas être présents.</p>

<p>Voici quelques infos:</p>

<ul>
  <li>
    <p>passwd contient des informations sur les utilisateurs enregistrés.</p>
  </li>
  <li>
    <p>group liste les groupes avec les utilisateurs associés.</p>
  </li>
  <li>
    <p>gshadow est uniquement consultable par root. Il contient des informations sur les groupes et les administrateurs.</p>
  </li>
</ul>

<p>AVANT TOUT, SACHEZ QUE JE NE SUIS PAS RESPONSABLE SI CES MANIPULATIONS ENTRAINENT DES PROBLÈMES. Chez moi, ça fonctionne.</p>

<p>Pour passwd et group, rien de bien compliqué. Plusieurs possibilités:</p>

<ul>
  <li>
    <p>Il y a les outils fournit par le paquet <a href="http://www.archlinux.org/packages/community/any/pacman-contrib/">pacman-contrib</a> (avec vimdiff par exemple).</p>
  </li>
  <li>
    <p>Des <a href="http://xyne.archlinux.ca/projects/pacnew_scripts/">scripts</a> en perl qui permettent le merge des fichiers.</p>
  </li>
  <li>
    <p>Vous pouvez passer par les commandes vipw et vigr pour les éditer, ajouter les lignes nécessaires et aussi vérifier la syntaxe (évite les erreurs). L’éditeur par défaut est vi, mais il est possible de passer par $EDITOR pour en spécifier un autre (qui a dit nano?). vipw edite le fichier /etc/passwd et vigr edite le fichier /etc/group.</p>

    <p>EDITOR=nano vigr</p>
  </li>
</ul>

<p>Je vous conseille une petite lecture de man:</p>

<pre><code>man vipw
</code></pre>

<p>ou</p>

<pre><code>man vigr
</code></pre>

<ul>
  <li>La méthode (color)diff pour voir les différences et les ajouter dans ces fichiers via nano. C’est cette méthode que j’utilise. Avec la coloration syntaxique et les comparaisons diff, je suis sûr de ne rien oublier. Et je prends connaissance des modifications, sans effectuer un simple merge bête et méchant.</li>
</ul>

<p>Avant de s’occuper du gshadow, je vous conseille d’utiliser grpck. Mais que fait-il? grpck vérifie l’intégrité des fichiers de groupes (format + données valides ou non). À utiliser avec sudo (ou su -c).</p>

<pre><code>grpck
</code></pre>

<p>Chez moi aucun soucis apparemment car la commande ne me retourne rien. J’utilise aussi la commande avec l’argument “-s”, qui permet de trier les lignes par GID dans les fichiers group et gshadow (de 0 vers 1000 par exemple). Cela est très utile, car le fichier est parfaitement lisible.</p>

<pre><code>grpck -s
</code></pre>

<p>Pour plus d’infos:</p>

<pre><code>man grpck
</code></pre>

<p>Déjà vous savez que les changements sont bons. Nous devons maintenant nous occuper du gshadow. Ce fichier n’est pas visible en simple utilisateur. Comme je suis plutôt minutieux et que je fais attention, je me suis renseigné sur la méthode la plus adapté / efficace.
Je ne l’éditerai pas, mais je passerai plutôt par la commande grpconv. Cette commande permets de créer un fichier gshadow à partir de group et d’un éventuel gshadow déjà existant.</p>

<pre><code>grpconv
</code></pre>

<p>Pour plus d’infos:</p>

<pre><code>man grpconv
</code></pre>

<p>Voilà c’est OK. Tout de même, sachez qu’il n’est pas forcément nécessaire de la faire, mais je préfère le faire. Je garde un système propre.</p>

<p><em>edit: Mise à jour des explications pour les fichiers concernés.</em></p>


</article>

<div class="barart"></div>

<div id="lastart">
	<h4>Derniers articles</h4>
	
		<div class="artlink"><span>&rsaquo; </span>21.02.2013<span>&nbsp;&rarr; </span><a href="/2013/02/potato-or-not/">Potato or not potato?</a></div>
	
		<div class="artlink"><span>&rsaquo; </span>11.01.2013<span>&nbsp;&rarr; </span><a href="/2013/01/2013-lannee-du-changement/">2013: l'année du changement</a></div>
	
		<div class="artlink"><span>&rsaquo; </span>05.10.2012<span>&nbsp;&rarr; </span><a href="/2012/10/guide-filesystem-archlinux/">Guide de l'upgrade de filesystem sous Archlinux</a></div>
	
		<div class="artlink"><span>&rsaquo; </span>31.08.2012<span>&nbsp;&rarr; </span><a href="/2012/08/surveillez-hdd-cron/">Surveiller son HDD avec cron</a></div>
	
		<div class="artlink"><span>&rsaquo; </span>03.08.2012<span>&nbsp;&rarr; </span><a href="/2012/08/ete-chaud/">L'été sera chaud!</a></div>
	
</div>


	<div class="barfoot"></div>

	<footer>
		<div>
			<a href="/archives">Archives</a>  &#124;
			<a href="https://github.com/Ypnose">Github</a>  &#124;
			<a href="https://bitbucket.org/Ypnose">Bitbucket</a>  &#124;
			<a href="https://twitter.com/tetedulinuxien/">Twitter</a>
		</div>
		<div>
			Blog amis:
			<a href="http://lazonelibre.eklablog.com/">Dempiller</a>  &#124;
			<a href="http://schoewilliam.legtux.org/">Schoewilliam</a>  &#124;
			<a href="http://blog.rolinh.ch/">Rolinh</a>  &#124;
			<a href="http://postblue.info/">Postblue</a>
		</div>
		<div>
			Copyright &copy; "Dans la Tête du Linuxien" 2011 / 2013 
			- Design par<a href="/qui-suis-je/">Ypnose</a>
		</div>
		<div>
			<a href="http://validator.w3.org/check?uri=http%3A%2F%2Ftetedulinuxien.fr&amp;charset=%28detect+automatically%29&amp;doctype=Inline&amp;group=0"><img src="/assets/images/html5.png" alt="html5" /></a>
			<a href="http://jigsaw.w3.org/css-validator/validator?uri=http%3A%2F%2Ftetedulinuxien.fr&amp;profile=css3&amp;usermedium=all&amp;warning=1&amp;vextwarning=&amp;lang=en"><img src="/assets/images/css3.png" alt="css3" /></a>
		</div>
	</footer>
	</div>
		<div id="button"><a href="#">&#94;</a></div>
</body>
</html>
